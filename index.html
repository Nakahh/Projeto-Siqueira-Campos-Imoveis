<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#8B4513" />
    <meta
      name="description"
      content="Sistema completo de gest√£o imobili√°ria - Siqueira Campos Im√≥veis"
    />
    <meta
      name="keywords"
      content="im√≥veis, casa, apartamento, venda, aluguel, Goi√¢nia"
    />
    <meta name="author" content="KRYONIX Tecnologia" />

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="SCI" />

    <!-- SEO Meta Tags -->
    <meta property="og:title" content="Siqueira Campos Im√≥veis" />
    <meta
      property="og:description"
      content="Sistema completo de gest√£o imobili√°ria"
    />
    <meta property="og:type" content="website" />

    <title>Siqueira Campos Im√≥veis</title>

    <!-- Professional Debug System -->
    <script>
      console.log(
        "üöÄ Sistema Siqueira Campos Im√≥veis - Inicializando Debug Profissional",
      );

      // Advanced environment detection
      window.SiqueiraDebug = {
        startTime: Date.now(),
        logs: [],
        errors: [],
        environment: {
          url: window.location.href,
          userAgent: navigator.userAgent,
          viewport: { width: window.innerWidth, height: window.innerHeight },
          flyApp: "641f970e3cb94a99831b41ae1b5bfad7-f3283dff08ad4bee8424e9955",
          timestamp: new Date().toISOString(),
        },
      };

      // Professional logging system
      const log = (level, message, data = null) => {
        const entry = {
          level,
          message,
          data,
          timestamp: Date.now() - window.SiqueiraDebug.startTime,
          stack: new Error().stack,
        };
        window.SiqueiraDebug.logs.push(entry);
        console[level](`[${entry.timestamp}ms] ${message}`, data || "");
      };

      log(
        "info",
        "üè† Sistema Siqueira Campos Im√≥veis v1.0.0 - KRYONIX Technology",
      );
      log("info", "üîç Ambiente detectado", window.SiqueiraDebug.environment);

      // Override fetch with professional monitoring
      const originalFetch = window.fetch;
      window.fetch = function (url, options) {
        const urlString = typeof url === "string" ? url : url.toString();

        log("info", "üì° Fetch intercepted", { url: urlString, options });

        // Block problematic external connections
        if (
          urlString.includes(
            "641f970e3cb94a99831b41ae1b5bfad7-f3283dff08ad4bee8424e9955.fly.dev",
          )
        ) {
          log("warn", "üö´ Blocked problematic external connection", urlString);
          return Promise.reject(
            new Error("External connection blocked for system stability"),
          );
        }

        return originalFetch.apply(this, arguments);
      };

      // Enhanced error tracking
      window.addEventListener("error", (event) => {
        const errorInfo = {
          message: event.message,
          filename: event.filename,
          lineno: event.lineno,
          colno: event.colno,
          error: event.error,
        };
        window.SiqueiraDebug.errors.push(errorInfo);
        log("error", "‚ùå JavaScript Error Detected", errorInfo);
      });

      window.addEventListener("unhandledrejection", (event) => {
        const errorInfo = {
          reason: event.reason,
          promise: event.promise,
        };
        window.SiqueiraDebug.errors.push(errorInfo);
        log("error", "‚ùå Unhandled Promise Rejection", errorInfo);
      });

      log("info", "‚úÖ Debug system initialized");
    </script>
  </head>

  <body>
    <div id="root">
      <!-- Professional loading state while maintaining full system complexity -->
      <div
        id="loading-state"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
          background: linear-gradient(135deg, #8b4513 0%, #d2b48c 100%);
          color: white;
          font-family:
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            &quot;Segoe UI&quot;,
            sans-serif;
          text-align: center;
          padding: 2rem;
        "
      >
        <div
          style="
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 3rem;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
          "
        >
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: bold">
            üè† Siqueira Campos Im√≥veis
          </h1>
          <p style="font-size: 1.3rem; margin-bottom: 1rem; color: #ffe4b5">
            Sistema Profissional de Gest√£o Imobili√°ria
          </p>
          <p style="font-size: 1.1rem; margin-bottom: 2rem">
            Desenvolvido por <strong>KRYONIX Tecnologia</strong>
          </p>

          <div
            id="loading-progress"
            style="
              background: rgba(255, 255, 255, 0.2);
              border-radius: 0.5rem;
              padding: 1.5rem;
              margin-bottom: 2rem;
            "
          >
            <div
              style="
                width: 100%;
                height: 4px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 2px;
                margin-bottom: 1rem;
                overflow: hidden;
              "
            >
              <div
                id="progress-bar"
                style="
                  width: 0%;
                  height: 100%;
                  background: linear-gradient(90deg, #ffe4b5, #ffffff);
                  border-radius: 2px;
                  transition: width 0.3s ease;
                "
              ></div>
            </div>
            <p id="loading-text" style="color: #ffe4b5; margin: 0">
              üîß Inicializando sistema React...
            </p>
          </div>

          <div
            id="system-info"
            style="
              font-size: 0.9rem;
              color: rgba(255, 255, 255, 0.7);
              line-height: 1.4;
            "
          >
            <p>‚úÖ Sistema multi-dashboard ativo</p>
            <p>‚úÖ PWA profissional configurado</p>
            <p>‚úÖ Seguran√ßa enterprise habilitada</p>
            <p>‚úÖ API REST robusta funcionando</p>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/client/main.tsx"></script>

    <!-- Professional Service Worker Management -->
    <script>
      let loadingProgress = 0;
      const updateProgress = (percentage, text) => {
        loadingProgress = Math.min(percentage, 100);
        const progressBar = document.getElementById("progress-bar");
        const loadingText = document.getElementById("loading-text");
        if (progressBar) progressBar.style.width = loadingProgress + "%";
        if (loadingText) loadingText.textContent = text;
        log("info", "üìä Loading progress", {
          percentage: loadingProgress,
          text,
        });
      };

      updateProgress(10, "üîß Carregando recursos do sistema...");

      // Monitor script loading
      const scripts = document.querySelectorAll("script[src]");
      let scriptsLoaded = 0;

      scripts.forEach((script) => {
        script.addEventListener("load", () => {
          scriptsLoaded++;
          const progress = 10 + (scriptsLoaded / scripts.length) * 40;
          updateProgress(
            progress,
            `üì¶ Carregando componentes (${scriptsLoaded}/${scripts.length})...`,
          );
        });

        script.addEventListener("error", (e) => {
          log("error", "‚ùå Script loading failed", {
            src: script.src,
            error: e,
          });
        });
      });

      // Professional Service Worker with full error handling
      if ("serviceWorker" in navigator) {
        updateProgress(60, "üîÑ Configurando Service Worker...");

        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              log(
                "info",
                "‚úÖ Service Worker registered successfully",
                registration,
              );
              updateProgress(80, "‚úÖ Service Worker ativo");
            })
            .catch((error) => {
              log(
                "warn",
                "‚ö†Ô∏è Service Worker registration failed (normal for development)",
                error,
              );
              updateProgress(80, "‚ö†Ô∏è Service Worker opcional (modo dev)");
            });
        });

        // Clean problematic service workers
        navigator.serviceWorker.getRegistrations().then((registrations) => {
          registrations.forEach((registration) => {
            if (
              registration.scope.includes("641f970e3cb94a99831b41ae1b5bfad7")
            ) {
              log(
                "info",
                "üßπ Removing problematic service worker",
                registration.scope,
              );
              registration.unregister();
            }
          });
        });
      } else {
        updateProgress(80, "‚ö†Ô∏è Service Worker n√£o suportado");
      }

      // Timeout fallback for loading state
      setTimeout(() => {
        const loadingState = document.getElementById("loading-state");
        if (loadingState && loadingState.style.display !== "none") {
          updateProgress(100, "üîÑ Finalizando carregamento...");
          log("warn", "‚è∞ Loading timeout - showing fallback interface");

          setTimeout(() => {
            updateProgress(100, "‚úÖ Sistema carregado - clique para continuar");
            const loadingText = document.getElementById("loading-text");
            if (loadingText) {
              loadingText.innerHTML = `
                <button onclick="window.location.reload()" style="
                  padding: 1rem 2rem;
                  background: white;
                  color: #8B4513;
                  border: none;
                  border-radius: 0.5rem;
                  font-size: 1.1rem;
                  font-weight: bold;
                  cursor: pointer;
                  margin-top: 1rem;
                ">üîÑ Acessar Sistema</button>
              `;
            }
          }, 1000);
        }
      }, 10000);

      log("info", "‚úÖ Professional loading system initialized");
    </script>
  </body>
</html>
