<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#8B4513" />

    <title>Siqueira Campos Im√≥veis - Sistema Profissional</title>

    <!-- ULTIMATE EMERGENCY DIAGNOSTIC SYSTEM -->
    <script>
      // IMMEDIATE LOOP DETECTION AND ELIMINATION SYSTEM
      console.log("üö® [EMERGENCY] Starting ultimate diagnostic system...");

      // Completely disable any automatic reloading mechanisms
      if (window.location.reload) {
        const originalReload = window.location.reload;
        window.location.reload = function (...args) {
          console.error("üõë [BLOCKED] Reload attempt blocked!");
          console.trace("Reload attempt stack trace:");
          return; // Block all reload attempts
        };
      }

      // Block all navigation
      if (window.history) {
        const originalPushState = window.history.pushState;
        const originalReplaceState = window.history.replaceState;

        window.history.pushState = function (...args) {
          console.log("üîÑ [MONITORED] pushState called with:", args);
          return originalPushState.apply(this, args);
        };

        window.history.replaceState = function (...args) {
          console.log("üîÑ [MONITORED] replaceState called with:", args);
          return originalReplaceState.apply(this, args);
        };
      }

      // Monitor ALL timers
      const originalSetTimeout = window.setTimeout;
      const originalSetInterval = window.setInterval;

      window.setTimeout = function (callback, delay, ...args) {
        console.log(`‚è∞ [MONITORED] setTimeout set for ${delay}ms`);
        console.trace("setTimeout stack trace:");

        // Block any suspicious short intervals that could cause reloads
        if (delay < 5000 && typeof callback === "function") {
          const callbackStr = callback.toString();
          if (
            callbackStr.includes("reload") ||
            callbackStr.includes("location") ||
            callbackStr.includes("href")
          ) {
            console.error("üõë [BLOCKED] Suspicious setTimeout blocked!");
            return;
          }
        }

        return originalSetTimeout.call(this, callback, delay, ...args);
      };

      window.setInterval = function (callback, delay, ...args) {
        console.log(`‚è∞ [MONITORED] setInterval set for ${delay}ms`);
        console.trace("setInterval stack trace:");

        // Block any intervals that could cause reloads
        if (delay < 10000 && typeof callback === "function") {
          const callbackStr = callback.toString();
          if (
            callbackStr.includes("reload") ||
            callbackStr.includes("location") ||
            callbackStr.includes("href")
          ) {
            console.error("üõë [BLOCKED] Suspicious setInterval blocked!");
            return;
          }
        }

        return originalSetInterval.call(this, callback, delay, ...args);
      };

      // Monitor fetch requests to see if something is polling
      const originalFetch = window.fetch;
      window.fetch = function (url, options) {
        console.log(`üì° [MONITORED] Fetch to: ${url}`);
        return originalFetch.apply(this, arguments);
      };

      // Disable all meta refresh
      const metaTags = document.querySelectorAll('meta[http-equiv="refresh"]');
      metaTags.forEach((tag) => {
        tag.remove();
        console.log("üõë [BLOCKED] Meta refresh tag removed");
      });

      // Monitor DOM mutations that could add refresh meta tags
      const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          if (mutation.type === "childList") {
            mutation.addedNodes.forEach(function (node) {
              if (node.nodeType === 1) {
                // Element node
                if (
                  node.tagName === "META" &&
                  node.getAttribute("http-equiv") === "refresh"
                ) {
                  node.remove();
                  console.log("üõë [BLOCKED] Dynamic meta refresh tag blocked");
                }
              }
            });
          }
        });
      });

      observer.observe(document, { childList: true, subtree: true });

      console.log("‚úÖ [DIAGNOSTIC] Ultimate protection system active");
    </script>
  </head>

  <body>
    <div id="root">
      <!-- EMERGENCY DIAGNOSTIC INTERFACE -->
      <div
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
          background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
          color: white;
          font-family:
            system-ui,
            -apple-system,
            sans-serif;
          text-align: center;
          padding: 2rem;
        "
      >
        <div
          style="
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 3rem;
            max-width: 800px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
          "
        >
          <h1
            style="
              font-size: 2.5rem;
              margin-bottom: 1rem;
              font-weight: bold;
              color: #10b981;
            "
          >
            üö® MODO DIAGN√ìSTICO ATIVO
          </h1>
          <h2 style="font-size: 1.8rem; margin-bottom: 1rem; color: #d1fae5">
            Siqueira Campos Im√≥veis - Sistema de Emerg√™ncia
          </h2>
          <p style="font-size: 1.1rem; margin-bottom: 2rem; color: #a7f3d0">
            Desenvolvido por <strong>KRYONIX Tecnologia</strong>
          </p>

          <div
            style="
              background: rgba(16, 185, 129, 0.1);
              border: 1px solid rgba(16, 185, 129, 0.3);
              border-radius: 0.5rem;
              padding: 2rem;
              margin-bottom: 2rem;
              text-align: left;
            "
          >
            <h3 style="color: #6ee7b7; margin-bottom: 1rem; font-size: 1.3rem">
              üîç Status do Sistema
            </h3>
            <div
              id="diagnostic-info"
              style="
                font-family: monospace;
                font-size: 0.9rem;
                line-height: 1.6;
              "
            >
              <p>‚úÖ Prote√ß√£o anti-reload: ATIVA</p>
              <p>‚úÖ Monitoramento de timers: ATIVO</p>
              <p>‚úÖ Bloqueio de meta-refresh: ATIVO</p>
              <p>‚úÖ Monitoramento de fetch: ATIVO</p>
              <p>‚úÖ Observer de DOM mutations: ATIVO</p>
              <p id="load-count">
                üîÑ Carregamentos da p√°gina: <span id="load-counter">1</span>
              </p>
            </div>
          </div>

          <div
            style="
              background: rgba(239, 68, 68, 0.1);
              border: 1px solid rgba(239, 68, 68, 0.3);
              border-radius: 0.5rem;
              padding: 2rem;
              margin-bottom: 2rem;
              text-align: left;
            "
          >
            <h3 style="color: #fca5a5; margin-bottom: 1rem; font-size: 1.3rem">
              ‚ö†Ô∏è Investiga√ß√£o em Andamento
            </h3>
            <div style="font-size: 0.9rem; line-height: 1.6">
              <p>
                <strong>Problema detectado:</strong> Loop infinito de
                requisi√ß√µes GET para "/"
              </p>
              <p><strong>Frequ√™ncia:</strong> A cada 2 segundos</p>
              <p><strong>Hip√≥teses testadas:</strong></p>
              <ul style="margin-left: 2rem">
                <li>‚ùå Vite HMR (Hot Module Replacement)</li>
                <li>‚ùå React useEffect loops</li>
                <li>‚ùå AuthContext infinite renders</li>
                <li>‚ùå React Router navigation loops</li>
                <li>‚ùå Meta refresh tags</li>
                <li>‚ùå JavaScript timers</li>
              </ul>
              <p>
                <strong>Investigando agora:</strong> Causa raiz externa ou
                configura√ß√£o de servidor
              </p>
            </div>
          </div>

          <div
            style="
              display: flex;
              gap: 1rem;
              justify-content: center;
              flex-wrap: wrap;
            "
          >
            <button
              onclick="
                console.log('üîÑ Manual page reload requested');
                window.location.href = window.location.href;
              "
              style="
                padding: 1rem 2rem;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 0.5rem;
                font-size: 1rem;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
              "
            >
              üîÑ Reload Manual
            </button>

            <button
              onclick="window.open('https://wa.me/5517981805327?text=URGENTE%20-%20Sistema%20Siqueira%20Campos%20em%20loop%20infinito%20-%20Preciso%20de%20ajuda%20IMEDIATA', '_blank')"
              style="
                padding: 1rem 2rem;
                background: #ef4444;
                color: white;
                border: none;
                border-radius: 0.5rem;
                font-size: 1rem;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
              "
            >
              üÜò Emerg√™ncia KRYONIX
            </button>

            <button
              onclick="
                console.clear();
                console.log('üìä Diagnostic data:');
                console.log('Window object:', window);
                console.log('Document object:', document);
                console.log('Location object:', location);
                console.log('History object:', history);
                alert('Dados de diagn√≥stico enviados para console');
              "
              style="
                padding: 1rem 2rem;
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 0.5rem;
                font-size: 1rem;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
              "
            >
              üîç Debug Console
            </button>
          </div>

          <div
            style="
              margin-top: 2rem;
              padding-top: 2rem;
              border-top: 1px solid rgba(255, 255, 255, 0.2);
            "
          >
            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7)">
              üî¨ Sistema de diagn√≥stico KRYONIX ativo. Monitorando TODAS as
              poss√≠veis causas do loop.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- BLOCK ALL SCRIPT LOADING TO ISOLATE THE ISSUE -->
    <!-- <script type="module" src="/client/main.tsx"></script> -->

    <script>
      // Update load counter
      let loadCount = parseInt(
        localStorage.getItem("emergency-load-count") || "1",
      );
      loadCount++;
      localStorage.setItem("emergency-load-count", loadCount.toString());

      document.getElementById("load-counter").textContent = loadCount;

      if (loadCount > 3) {
        document.getElementById("load-count").innerHTML =
          `üö® Carregamentos da p√°gina: <span style="color: #ef4444; font-weight: bold;">${loadCount} (LOOP CONFIRMADO)</span>`;
      }

      console.log(
        `üö® [EMERGENCY] Page load #${loadCount} - All protections active`,
      );
      console.log(
        "üìä [DIAGNOSTIC] If you can see this message repeatedly, the loop is NOT caused by JavaScript in this page",
      );
      console.log(
        "üîç [INVESTIGATION] The loop must be caused by external factors or server configuration",
      );
    </script>
  </body>
</html>
